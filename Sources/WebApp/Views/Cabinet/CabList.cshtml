@using WebApp.Settings;
@using ModelLib.Convert.Attributes;
@using ModelLib.Convert.Table;
@using ModelLib.DTO;

@model IEnumerable<CabinetDTO>;

@{
    Layout = "_CabList";

    TranslateMetadata<IMetaData> meta = new();
    meta.Assign<CabinetDTO>();
}

@section CabinetInfoScripts {
    <link href="~/css/Tools.css" rel="stylesheet" type="text/css" />
    <link href="~/css/Table.css" rel="stylesheet" type="text/css" />
    <script src="~/js/jquery-3.7.1.min.js" type="text/javascript"></script>
    <link href="~/css/RightMenu.css" rel="stylesheet" type="text/css" />
    <script src="~/js/RightMenu.js" type="text/javascript"></script>
    <script src="~/js/signalr.js"></script>
    <script src="~/js/jquery.signalR.min.js"></script>
    <script src="~/js/InfoEditor.js" type="text/javascript"></script>
    <link href="~/css/InfoEditor.css" rel="stylesheet" type="text/css" />
    <link href="~/css/ElementsStyle.css" rel="stylesheet" type="text/css" />
}

@section CabTable {
    <table>
        <tr>
            <th class="header" colspan="100%">
                @meta.TableName
            </th>
        </tr>
        <tr>
            @{
                foreach (var header in meta.GetPropName(PropertyInclusion.Include))
                {
                    <th>@header.Value</th>
                }
                <th></th>
            }
        </tr>
        @{
            foreach(var cabinet in Model)
            {
                //var cabId = meta.HasAttribute<InclusionInHeader>(nameof(cabinet.Id));
                var values = meta.GetValues(cabinet);

                <tr>
                    @{
                        if (values != null)
                        {
                            if (values[nameof(cabinet.Id)] is int cabId)
                            {
                                <td>@cabId</td>
                            }

                            if (values[nameof(cabinet.Num)] is int cabNum)
                            {
                                <td>@cabNum</td>
                            }

                            if (values[nameof(cabinet.PlanNum)] is int cabPlanNum)
                            {
                                <td>@cabPlanNum</td>
                            }

                            if (values[nameof(cabinet.ResponsiblePerson)] is ModelLib.DTO.UserDTO resp)
                            {
                                <td>
                                    <button onclick="window.location = '../profile=@resp.Id'">
                                        <p>@resp.Surname</p>
                                        <p>@resp.Name</p>
                                        <p>@resp.Patronymic</p>
                                    </button>
                                </td>
                            }
                            else
                            {
                                <td></td>
                            }

                            if (values[nameof(cabinet.Floor)] is int floor)
                            {
                                <td>@floor</td>
                            }

                            if (values[nameof(cabinet.Height)] is double height)
                            {
                                <td>@height</td>
                            }

                            if (values[nameof(cabinet.Length)] is double length)
                            {
                                <td>@length</td>
                            }

                            if (values[nameof(cabinet.Width)] is double width)
                            {
                                <td>@width</td>
                            }

                            if (values[nameof(cabinet.SquareFloor)] is double squareFloor)
                            {
                                <td>@squareFloor</td>
                            }

                            if (values[nameof(cabinet.SquareWall_1)] is double squareWall_1)
                            {
                                <td>@squareWall_1</td>
                            }

                            if (values[nameof(cabinet.SquareWall_2)] is double squareWall_2)
                            {
                                <td>@squareWall_2</td>
                            }
                        }
                    }
                    <td>
                        <button onclick="window.location = '../cabinets/cabientId=@cabinet.Id'">Перейти</button>
                    </td>
                </tr>
            }   
        }     
        <tr>
            <th class="footer" colspan="100%">
                <button class="defaultButton" onclick="openEditor(infoType.cabinet, sendType.new, null)">Добавить кабинет</button>
            </th>
        </tr>
    </table>

    
}